! ---------------------------------------------------------
! Device: Core Router (GNS3)
! Role: Inter-VLAN Routing & Internet Gateway
! ---------------------------------------------------------

! --- Subinterface setup ---
enable
configure terminal
interface Ethernet0/0
no shutdown
exit

interface Ethernet0/0.10
encapsulation dot1q 10
ip address 192.168.10.1 255.255.255.0
exit

interface Ethernet0/0.20
encapsulation dot1q 20
ip address 192.168.20.1 255.255.255.0
exit

interface Ethernet0/0.30
encapsulation dot1q 30
ip address 192.168.30.1 255.255.255.0
exit

end
write memory

! --- Firewall interface setup ---
configure terminal
interface Ethernet0/1
description Firewall-Link
ip address 10.0.0.1 255.255.255.252
no shutdown
exit

ip route 0.0.0.0 0.0.0.0 10.0.0.2

end
write memory

! --- DHCP setup ---
ip dhcp excluded-address 192.168.20.1
ip dhcp pool KALI
network 192.168.20.0 255.255.255.0
default-router 192.168.20.1
dns-server 8.8.8.8
exit

ip dhcp excluded-address 192.168.30.1
ip dhcp pool WINDOWS
network 192.168.30.0 255.255.255.0
default-router 192.168.30.1
dns-server 8.8.8.8
exit

end
write memory

! --- Sending logs to Wazuh ---

configure terminal
logging host 192.168.10.10

end
wr

! --- Setting up ACLs ---

ip access-list extended SECURE-VLANS
permit tcp any host 192.168.10.10 eq 1514
permit udp any host 192.168.10.10 eq 1514
permit tcp any host 192.168.10.10 eq 1515
deny ip 192.168.30.0 0.0.0.255 192.168.10.0 0.0.0.255
permit ip any any
exit

interface Ethernet0/0.30
ip access-group SECURE-VLANS in
exit

end
wr
